> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [chat.zchat.tech](https://chat.zchat.tech/c/691ffc3a-4fe8-8328-8280-9fa0af3c9c08)

> ChatGPT 是一款供日常使用的 AI 聊天机器人。与最先进的 AI 模型互动，探索创意、解决问题以及提升学习效率。

这节课大概就是教你：**Linux 安装完之后，要怎么把这台机器 “收拾好、管好、用顺手”。**

Linux Sysadmin Decal Fall 2020,…

我用特别白话帮你按模块说一遍：

一、装完系统，还没完事
-----------

老师一上来就说：系统虽然装好了，但还不算能安心用。  
还要做这些事：

1.  建用户、建用户组
    
2.  给谁什么权限，谁不能干什么
    
3.  把远程登录（SSH）和网络安全配好
    
4.  装一些基本工具软件
    
5.  让这台机器变成 “真 · 能工作” 的系统
    

二、用户和用户组：谁能干什么
--------------

可以把电脑想成一个**大房子**：

*   **用户（user）** = 住在这个房子里的每个人（账号）
    
*   **用户组（group）** = 某一类人组成的群，比如 “管理员组”“开发组”
    

课程里讲了：

1.  Linux 用 “用户 + 用户组 + 权限” 来控制谁能看 / 改哪些文件、能运行什么程序。
    
2.  每个文件都有 “主人” 和“所属的组”，程序是以某个用户的身份在跑的。
    
3.  登录终端时，系统先以 **root** 启动登录程序，再切换成你这个普通用户，把你的 shell（比如 `/bin/zsh`）跑起来，以后你开的所有程序都是这个 shell 的 “孩子”。
    

### 安全角度

*   系统核心（kernel）会根据用户 ID（uid）和组 ID（gid）决定放不放你干某件事。  
    不行就报错 “Permission Denied”。
    
*   CPU 也分等级：
    
    *   **Ring 3**：普通用户模式
        
    *   **Ring 0**：内核 / 超级管理员模式
        
*   **root 用户（uid/gid = 0）就是 “超级大号”**：
    
    *   能读任何文件、执行任何程序。
        
    *   一旦有程序以 root 身份被黑客利用，那几乎所有保护都没了。
        
<!--ID: 1764664440307-->


**重点：root 权限非常危险，不要什么都用 root 跑。**

三、创建和管理用户 / 用户组
---------------

### 创建用户

*   用 `useradd` 或更友好的 `adduser` 来建账号：
    
    *   可以设：要不要创建 home 目录、默认 shell、加到哪些组、账号过期时间……
        
    *   信息会写到 `/etc/passwd` 里面。
        
*   用 `passwd` 给用户设密码，密码的哈希会放在 `/etc/shadow`。
    
<!--ID: 1764664440314-->


### 管理用户

*   看有哪些用户：`cat /etc/passwd`、`getent passwd` 等。
    
*   删除用户：`userdel`。
    
    *   要小心：文件是按 **uid** 认主人的，如果删了一个用户，再新建一个用户拿到了同样的 uid，原来那些文件就会 “算在” 新用户头上，所以要注意修正权限。
        
*   **系统用户**：一堆 uid 在 100–499 范围里的账号，给服务用的，比如 `www-data`、`nobody` 之类，不是人登录用的。
    
<!--ID: 1764664440320-->


### 用户组

*   每个用户有一个**主组**（一般跟用户名一样）。
    
*   还可以被加到**附加组**里，比如 `wheel`、`sys`。
    
*   新建组：`groupadd` / `addgroup`
    
*   删除组：`groupdel` / `delgroup`
    
*   查看某组里有谁：`groups`、`getent group xxx`、`cat /etc/group` 等。
    
<!--ID: 1764664440326-->


### 临时切换用户 / 组

*   `su` = switch user，切换成别的用户
    
*   `sg` = switch group，切换组
    
*   用来帮别的用户改东西时要注意隐私和安全。
    
<!--ID: 1764664440330-->


四、sudo：有时候当一下 “临时小 root”
------------------------

你不想整天用 root 登录，但有时候又需要做需要大权限的事（装软件、改系统配置）。

做法：

*   Linux 用 `/etc/sudoers` 这个文件来配置谁可以用 `sudo` 暂时提权。
    
*   只能用 `visudo` 等工具去改它，因为如果写错语法，整个 sudo 功能可能废掉。
    
*   把某个用户或用户组加到 sudoers 里，这样他们就能用 `sudo 命令` 以 root 权限执行某些操作。
    

**老师反复强调：不要遇到报错就条件反射在前面加一个 `sudo`。  
要先想清楚：我真的需要管理员权限吗？这个命令安全吗？**

五、（进阶）文件系统工具
------------

这部分稍微高级一点，但讲的是：

*   `lsattr` / `chattr`：除了常见的 r/w/x 权限，还有一些特殊属性，比如：
    
    *   文件设成 “不可改”“不可删” 等。
        
*   `fsck`：文件系统检查工具，出故障时帮你找回孤立的文件、坏掉的 inode，类似 Windows 的 `chkdsk`。
    

六、SSH 远程登录与安全
-------------

这一块是说：**别人怎么从网络远程连到你的机子上，同时不被黑。**

### SSH 登录方式

*   可以用：密码、SSH 密钥（公钥 / 私钥）、GSSAPI（Kerberos）等。
    
*   默认情况下，sshd（SSH 服务器）允许机器上的任何用户登录，甚至 root 也能用密码登录，这会很危险。
    
<!--ID: 1764664440333-->


### 修改 `/etc/ssh/sshd_config`

常见配置：
<!--ID: 1764664440339-->


*   `PasswordAuthentication yes/no`
    
    *   是否允许用密码登录。如果开着，别人可以暴力猜密码。
        
*   `PermitRootLogin yes/no/without-password`
    
    *   root 能不能直接登录。
        
    *   `without-password` = 只能用密钥，不能用密码。
        
*   `PubKeyAuthentication yes/no`
    
    *   是否允许用 SSH 密钥登录（比密码安全得多）。
        
*   `GSSAPIAuthentication yes/no`
    
    *   使用 Kerberos 之类的集中认证。
        

### 课上还演示了生成 SSH 密钥的大致流程

比如：
<!--ID: 1764664440345-->


1.  `ssh-keygen -t rsa -b 4096` 生成密钥（可以设不设密码）。
    
2.  用 `ssh-copy-id user@host` 把公钥复制到远程机器。
    
3.  以后用 `ssh user@host` 就可以直接用密钥登录。
    
4.  可以在 `~/.ssh/config` 里面写好别名、用户名、密钥路径等，方便使用。
    

### 减少 SSH 被攻击的风险

老师提了一些建议：
<!--ID: 1764664440351-->


1.  重要账号要用**强密码**。
    
2.  尽量用 **SSH 密钥** 登录，少用密码。
    
3.  SSH 服务只绑定在内部网络或 VPN 后面，而不是公共互联网。
    
4.  定期看 `/var/log/auth.log`，注意有没有奇怪的登录。
    
5.  用 Fail2Ban 之类的工具：
    
    *   尝试登录失败几次，就用防火墙 ban 掉那个 IP，防止暴力破解。
        

七、防火墙：站在门口的保安
-------------

防火墙就是**决定哪些网络连接能进来，哪些被拦住**。

*   底层工具是 `iptables`，功能很强，但命令很复杂。
    
*   对个人服务器来说，可以用一个更简单的东西：`ufw`（Uncomplicated FireWall）。
    

一些例子：

*   `sudo ufw default deny`
    
    *   默认全部拒绝（推荐）。
        
*   `sudo ufw allow 80/tcp`
    
    *   放行网页 HTTP 的 80 端口。
        
*   `sudo ufw allow SSH`
    
    *   放行 SSH 的 22 端口。
        
*   `sudo ufw status`
    
    *   看现在有哪些规则。
        

八、Linux 目录结构：系统的大地图
-------------------

课件里有一张树状图，展示了从 `/`（根目录）往下的一堆目录。主要意思是：**每个目录都有专门的用途。**

举几个重要的：

*   `/boot`：开机要用的东西，里面有内核文件 `vmlinuz`。
    
*   `/dev`：不是普通文件，而是各种设备的 “接口”，比如硬盘、U 盘。
    
*   `/etc`：一大堆配置文件，非常重要，备份时要考虑它。
    
*   `/home`：每个普通用户自己的家目录都在这里。
    
*   `/lost+found`：文件系统检查（fsck）找回来的碎片文件会放这里。
    
*   `/media`：自动挂载的设备（U 盘、移动硬盘）会挂到这里。
    
*   `/opt`：一些不遵守标准层次的程序会装到这里，比如某些软件的独立目录。
    
*   `/proc`：也是个 “假” 文件系统，里面是当前系统和进程的信息。
    
*   `/root`：root 用户的家目录。
    
*   `/run`、`/tmp`：存放临时文件，重启后通常会清空。
    
*   `/srv`：给服务器程序提供数据的地方（HTTP、FTP 的内容）。
    
*   `/sys`：给 root 看系统硬件、内核信息的 “接口”。
    
*   `/var`：放那些会经常变化的东西，比如日志、数据库等。
    
*   `/bin`、`/usr/bin`、`/sbin` 等：各种可执行程序，组成你的 `$PATH`。
    
*   `/lib`、`/usr/lib`：程序用到的库文件。
    
*   `/usr/share`：可以在多台机器上共享的数据。
    
*   `/usr/local/man`：man 手册页。
    

九、常用小工具 & 个性化设置
---------------

### 建议安装的一些工具

*   `tmux`：一个终端复用工具，可以在一个窗口里开很多 “子终端”。
    
*   `htop`：比 `top` 更好看的进程 / 系统状态监视器。
    
*   `vim`：老师说是 “最好的编辑器”。
    
*   在 Arch 系统下，还可以装一些 AUR 帮手，比如 `yay` 等，方便装社区包。
    
<!--ID: 1764664440357-->


### dotfiles：把系统变成 “我的风格”

**dotfiles** 就是那种以点开头的配置文件，比如 `.bashrc`、`.vimrc`，用来定制你自己的环境。
<!--ID: 1764664440364-->


*   `.bashrc`：每次打开 bash 时会执行，可以在这里：
    
    *   改 PATH、设置别名、换颜色主题等等。
        
*   `.vimrc`：专门给 vim 用的配置，装插件、改快捷键、改行为都在这。
    
*   `~/.config/`：很多图形程序或工具会在这里放自己的配置。
    

老师的意思是：**大胆折腾这些配置，让系统更好用、更顺手。**

十、整堂课的核心总结
----------

用一句超简短的话说，这堂 “Linux 安装后” 课程在讲：

> 安装完 Linux 之后，要
> 
> *   合理地创建和管理用户 / 用户组，
>     
> *   正确使用 sudo 和权限，保证安全；
>     
> *   配好 SSH 登录和防火墙，减少被黑机会；
>     
> *   搞懂系统目录大概都干什么用；
>     
> *   安装一些好用的小工具，并用 dotfiles 把环境调成你习惯的样子。
>